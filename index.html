<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>TormBlog X</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      background: #000;
      color: #fff;
      font-family: 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
    }
    .center {
      max-width: 500px;
      margin: 40px auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
      font-weight: 600;
      font-size: 28px;
      margin-bottom: 20px;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 6px 0;
      border-radius: 9999px;
      border: none;
      font-size: 15px;
    }
    input {
      background: #16181c;
      color: #fff;
      border: 1px solid #2f3336;
    }
    button {
      background: #1d9bf0;
      color: #fff;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #1a8cd8;
    }
    #timeline {
      display: none;
    }
    .post {
      background: #16181c;
      border: 1px solid #2f3336;
      padding: 12px;
      margin: 8px 0;
      border-radius: 12px;
      font-size: 15px;
    }
    .user {
      color: #1d9bf0;
      font-weight: 500;
    }
  </style>
</head>
<body>

<div class="center" id="auth">
  <h1>TormBlog</h1>
  <input type="text" id="user" placeholder="Nombre de usuario">
  <input type="password" id="pass" placeholder="Contraseña">
  <button onclick="login()">Iniciar sesión</button>
  <button onclick="register()">Registrarse</button>
</div>

<div class="center" id="timeline">
  <h1>TormBlog</h1>
  <input type="text" id="newpost" placeholder="¿Qué está pasando?" maxlength="280">
  <button onclick="post()">Publicar</button>
  <div id="posts"></div>
  <button onclick="logout()">Cerrar sesión</button>
</div>

<script>
// Configuración de Firebase (Cambia esto con tu proyecto real)
const firebaseConfig = {
  apiKey: "AIzaSyAKV9aBfrkLbOKN29PxfQE1eJ3anqqQuPw",
  authDomain: "tormblog.firebaseapp.com",
  databaseURL: "https://tormblog-default-rtdb.firebaseio.com",
  projectId: "tormblog",
  storageBucket: "tormblog.firebasestorage.app",
  messagingSenderId: "653253582479",
  appId: "1:653253582479:web:4c98e83c6ee5efea8d5afa"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let currentUser = "";

async function register() {
  const u = document.getElementById("user").value.trim();
  const p = document.getElementById("pass").value.trim();

  if (!u || !p) { alert("Completa ambos campos"); return; }

  const userRef = db.collection("users").doc(u);
  const doc = await userRef.get();

  if (doc.exists) {
    alert("El usuario ya existe");
  } else {
    await userRef.set({ password: p });
    alert("Registro exitoso, inicia sesión");
  }
}

async function login() {
  const u = document.getElementById("user").value.trim();
  const p = document.getElementById("pass").value.trim();

  const userRef = db.collection("users").doc(u);
  const doc = await userRef.get();

  if (doc.exists && doc.data().password === p) {
    currentUser = u;
    showTimeline();
  } else {
    alert("Usuario o contraseña incorrectos");
  }
}

function showTimeline() {
  document.getElementById("auth").style.display = "none";
  document.getElementById("timeline").style.display = "block";
  getPosts();
}

async function post() {
  const text = document.getElementById("newpost").value.trim();
  if (text) {
    await db.collection("posts").add({
      user: currentUser,
      text: text,
      date: new Date()
    });
    document.getElementById("newpost").value = "";
  }
}

function logout() {
  currentUser = "";
  document.getElementById("timeline").style.display = "none";
  document.getElementById("auth").style.display = "block";
}

function getPosts() {
  db.collection("posts").orderBy("date", "desc").onSnapshot(snapshot => {
    const container = document.getElementById("posts");
    container.innerHTML = "";

    snapshot.forEach(doc => {
      const data = doc.data();
      const div = document.createElement("div");
      div.className = "post";
      div.innerHTML = `<span class="user">@${data.user}</span><br>${data.text}`;
      container.appendChild(div);
    });
  });
}

</script>

</body>
</html>
